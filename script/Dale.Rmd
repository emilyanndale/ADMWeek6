---
title: "Case Study"
author: "Emily Dale"
date: "April 22, 2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_knit$set(root.dir = 'C:/Users/eaust/OneDrive/Documents/R/Week6/data')
 
```

```{r, include = FALSE}
bank <- read.csv("bank-full.csv")
```

# Data Exploration

```{r}
summary(bank)
```

Check for missing values
```{r}
pMiss <- function(x){sum(is.na(x))/length(x)*100}
apply(bank,2,pMiss)

```
No missing values so we can continue.

Recode variables for clustering

```{r}
bankCluster <- bank
names(bankCluster)
```

```{r}
#Recode Ages
bankCluster$Age18_24 <- ifelse(bankCluster$age..number < 25 & bankCluster$age..number >= 18, 1, 0)
bankCluster$Age25_34 <- ifelse(bankCluster$age..number < 35 & bankCluster$age..number >= 25, 1, 0)
bankCluster$Age35_44 <- ifelse(bankCluster$age..number < 45 & bankCluster$age..number >= 35, 1, 0)
bankCluster$Age45_54 <- ifelse(bankCluster$age..number < 55 & bankCluster$age..number >= 45, 1, 0)
bankCluster$Age55_64 <- ifelse(bankCluster$age..number < 65 & bankCluster$age..number >= 55, 1, 0)
bankCluster$age..number <- NULL
```

```{r}
bankCluster$homeLoan <- ifelse(bankCluster$housing..category == "yes", 1, 0)
bankCluster$housing..category <- NULL
```

```{r}
bankCluster$defaultYes <- ifelse(bankCluster$default..category == "yes", 1, 0)
bankCluster$default..category <- NULL
```

```{r}
bankCluster$personalLoan <- ifelse(bankCluster$loan..category == "yes", 1, 0)
bankCluster$loan..category <- NULL
```


```{r}
bankCluster$eduPrimary <- ifelse(bankCluster$education..category == "primary", 1, 0)
bankCluster$eduSecondary <- ifelse(bankCluster$education..category == "secondary", 1, 0)
bankCluster$eduTertiary <- ifelse(bankCluster$education..category == "tertiary", 1, 0)
bankCluster$education..category <- NULL
```

```{r}
bankCluster$admin <- ifelse(bankCluster$job..category == "admin", 1, 0)
bankCluster$blueCollar <- ifelse(bankCluster$job..category == "blue-collar", 1, 0)
bankCluster$entrepreneur <- ifelse(bankCluster$job..category == "entrepreneur",1, 0)
bankCluster$housemaid <- ifelse(bankCluster$job..category == "housemaid", 1, 0)
bankCluster$management <- ifelse(bankCluster$job..category == "management", 1, 0)
bankCluster$retired <- ifelse(bankCluster$job..category == "retired", 1, 0)
bankCluster$selfEmployed <- ifelse(bankCluster$job..category == "self-employed", 1, 0)
bankCluster$services <- ifelse(bankCluster$job..category == "services", 1, 0)
bankCluster$student <- ifelse(bankCluster$job..category == "student", 1, 0)
bankCluster$technician <- ifelse(bankCluster$job..category == "technician", 1, 0)
bankCluster$unemployed <- ifelse(bankCluster$job..category == "unemployed", 1, 0)
bankCluster$job..category <-NULL
```

```{r}
bankCluster$married <- ifelse(bankCluster$marital..category == "married", 1, 0)
bankCluster$single <- ifelse(bankCluster$marital..category == "single", 1, 0)
bankCluster$marital..category <- NULL
```

```{r}
bankCluster$subscriber <- ifelse(bankCluster$y..category == "yes", 1, 0)
bankCluster$y..category <- NULL
```

```{r}
bankCluster <- bankCluster[, -c(1:9)]
```

```{r}
summary(bankCluster)
```

```{r}
set.seed(1234)
bank_cluster_2 <- kmeans(bankCluster, centers=2) 
Clusters_2<-data.frame(bank_cluster_2$centers)
bank_cluster_2$size
#View(t(Clusters_2))
```


![      *Characteristics of Hometown Bank's Two Primary Groups*](C:/Users/eaust/OneDrive/Documents/R/Week6/data/Clusters.png) 

# Decision Tree

Split into train and test set. For this assignment I'm trying out caTools package with sample.split.
```{r}
set.seed(1234)
library(caTools)
?caTools
bank$spl <- sample.split(bank[,1], SplitRatio = 0.7)
```

```{r}
bank_train <- subset(bank, bank$spl ==TRUE)
bank_test <- subset(bank, bank$spl==FALSE)
```

```{r}
bank_train$spl <- NULL
bank_test$spl <-NULL
```

Build Tree

```{r, warning=FALSE}
library(rpart)
set.seed=1234
bank_rpart <- rpart(bank_train$y..category~., method="class", parms = list(split="gini"), data=bank_train)
```

```{r}
library(rpart.plot)
rpart.plot(bank_rpart, type=0, extra=101)
```
This decision tree shows that those customers more likely to subcribe are:
* those who were last contacted within the previous 132-522 days and whose last outcome was successful.
* those who were not contacted in the last 828 days.
* those who were last contacted within the previous 522-828 days and whose last outcome was successful.
```{r}
levels(bank$poutcome..category)
```


```{r}
library(caret)
actual <- bank_test$y..category
predicted <- predict(bank_rpart, bank_test, type="class")
results.matrix <- confusionMatrix(predicted, actual, positive="yes")
print(results.matrix)
```

The measure we want to focus on is specificity. To avoid wasting staff to subcribe, so finding true negatives is the most important factor. In this case, the model found true negatives at a rate of 97.2%, so we can say with 97% certainty that those customers shouldn't be contacted. More effort and resources can be spent on the other customers. 







